# ガントチャート（Gantt）マクロ 改善メモ

## 目的

既存のガントチャート（Excelマクロ）を、**操作ミス防止・視認性向上・再現性の高い表示制御**という観点で改善するための要件メモ。

---

## 改善要件一覧

### ① マクロ線の描画条件拡張

- イナズマ線（進捗線）の描画ロジック：
  - **「今日」の赤線（縦）** を表示する。
  - **進捗に基づくイナズマ線（オレンジ等）** を表示する。
  - 基準線（ベースライン）や自動リアルタイム更新は不要（ボタン更新で可）。
  - 参考画像のスタイル（赤縦線＋オレンジ折れ線）に準拠する。

### ② 実績線の表示制御  ※本機能の要否は人による好みとなる

- **作業が完了するまで**、実績線は表示しない。
- 完了フラグが立ったタイミングで初めて表示する。

### ③ イラズマガント表示仕様

- **常に標準のイナズマ線を表示**する状態とする。
- 比較用（基準）ガント線は不要。

### ④ 表セットアップ時のキャンセル制御

- 表のセットアップ中に **×ボタン** が押された場合：
  - 途中までの処理も含め、
  - **すべての処理を実行しない（完全キャンセル）**。

### ⑤ 土日表示の切り替え機能

- Gantt表の**土日列**について：
  - 「表示」ボタン → 土日を表示
  - 「非表示」ボタン → **土日列の列幅を0にして非表示**にする（カレンダーを詰める）。
- ユーザー操作で即時切り替え可能にする。

### ⑥ 行の高さ統一

- 表内の**すべての行の高さを 22 に統一**する。
- 列幅についても、参考画像に従い調整する。
  - LV: 3, No.: 4,
  - TASK(Lv1-3): 4
  - TASK(Lv4): 15
  - タスク補足: 20
  - 状況: 7
  - 進捗率: 7
  - 担当: 7
  - 日付列(予定/実績): 8.7

### ⑦ 罫線自動整形機能

- 見やすく、崩れにくい
- 参考画像を元にした**きれいな罫線・塗りつぶしを自動で適用する機能**を追加する。

### ⑧ 表示形式・罫線のリセット機能

- 表示形式や罫線が崩れた場合に、
  **ワンクリックで復旧**できるようにする。
- 以下のリセットボタンを用意する：
  - 表示形式リセットボタン
  - 罫線リセットボタン

### ⑨ No. 初期セット機能

- セットアップ（ウィザード）実行時に、
  - **No.1 〜 400 までを自動で予め採番・入力**しておく。

### ⑩ 完了ボタンの誤作動防止

#### 基本方針

- **もともと完了している行は、何も変更しない**。

#### 操作ルール

- 以下の操作でのみ「完了」状態にできるようにする：
  - **No.列をクリック**
  - **レベル列をクリック**

- それ以外のセル操作では、
  完了処理が発動しないよう制限する。

### ⑪ UI配置

- 各種操作ボタン（土日切替、リセット等）は、シート上部の空きスペース（1行目〜5行目）に配置する。
- レイアウト詳細は参考画像に準拠する。

---

## 補足

- 本メモは要件定義・実装設計・マクロ改修の
  ベース資料として使用する。
- 実装時は Excel 2016 / Microsoft 365 両対応を前提とする。

---

## レイアウト・描画仕様詳細 (添付資料に基づく)

### 1. シートレイアウト設定

- **ヘッダーエリア**:
  - 行高さ: 30 (タイトル行), 22 (その他)
  - **コマンドボタンエリア**: 1行目〜5行目の空きスペース（A-H列付近）に配置。
  - **情報表示エリア**: K-L列（開始日、週表示、今日）
  - **ヘッダー行 (8行目)**: 背景色 青色 (RGB: 48, 84, 150想定), 文字色 白, 中央揃え。

- **列幅設定 (数値指定)**:
  - **A列 (LV)**: 3
  - **B列 (No.)**: 4
  - **C〜E列 (TASK Lv1-3)**: 4 (インデント用)
  - **F列 (TASK Lv4)**: 15 (タスク名表示用)
  - **G列 (タスク補足)**: 20
  - **H列 (状況)**: 7
  - **I列 (進捗率)**: 7
  - **J列 (担当)**: 7
  - **K〜L列 (日付)**: 8.7
  - **O列以降 (ガント)**: 3 (自動調整)

### 2. ガントチャート描画仕様

- **予定バー**:
  - 色: 薄い灰色 (RGB: 245, 245, 245)
  - 枠線: 黒 (細線)
  - 高さ: 6
- **進捗バー**:
  - 色: 紺色 (RGB: 48, 84, 150)
  - 表示: 予定バーの上に重ねて描画
- **実績バー**:
  - 色: 緑色 (RGB: 0, 176, 80)
  - **表示条件**: ステータスが「完了」または進捗100%の場合のみ、予定バーの下段に表示。
- **イナズマ線 (Inazuma)**:
  - **今日線**: 赤色 (RGB: 255, 0, 0), 縦線 (太さ2)
  - **進捗線**: オレンジ色 (RGB: 255, 165, 0), 各タスクの進捗位置を結ぶ折れ線。
  - 基準: 予定より遅れている場合は左側へ、進んでいる/完了の場合は右側へ伸びる標準的な形状。

## 残課題・不明点（確認事項）

| No. | 項目 | 内容 | 備考 |
|---|---|---|---|
| 1 | 実績線の表示 | 「機能の要否は人による」との記載あり。現状は「完了時のみ表示」で実装しているが、進行中でも表示したい場合のオプション化が必要か？ | 現状は完了時のみ（Fix） |
| 2 | キャンセル制御 | セットアップ中のキャンセル時、作成途中のシートを残すか、削除して元に戻すか？ | 現状は処理中断のみ |
| 3 | 厳密な色指定 | 添付画像の青・緑・オレンジなどの厳密なRGB値指定があるか？ | 目視による近似値で設定中 |
| 4 | タスク階層幅 | Lv4(F列)が15、Lv1-3(C-E)が4となっているが、Lv1タスク名が長い場合のはみ出し制御はどうするか？ | 現状はセル結合なし・そのまま表示 |
