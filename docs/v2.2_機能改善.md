# InazumaGantt v2.2 機能改善ドキュメント

## 実装機能一覧

| No. | 機能 | 機能の詳細 | 関連マクロ |
|-----|------|-----------|-----------|
| 1 | 設定マスタ | ダブルクリック完了の動作を制御するシート | `EnsureSettingsSheet`, `GetSettingValue` |
| 2 | 折りたたみ | LV1タスク配下の行を表示/非表示切替 | `ToggleTaskCollapse` |
| 3 | No.自動採番 | 行挿入後も連番を維持 | `RenumberRows` |
| 4 | 日付シフト | 選択範囲の日付を営業日単位でシフト（祝日考慮） | `ShiftDates` |
| 5 | PDF出力 | タスク情報と当月末までのガントをPDF出力 | `ExportToPDF` |
| 6 | 日付バリデーション | 日付入力の形式チェックと開始日>終了日警告 | `ValidateDateInput` |
| 7 | 進捗率バリデーション | 進捗率の範囲チェック | `ValidateProgressInput` |
| 8 | 完了ダブルクリック | B列ダブルクリックで完了処理（取り消し線・灰色対応） | SheetModule |

---

## No.1 設定マスタ

### 概要

ダブルクリック完了処理の動作を制御する設定シートを作成します。

### 使い方

マクロ `EnsureSettingsSheet` を実行すると「設定マスタ」シートが作成されます。

### 設定項目

| 行 | 項目 | デフォルト | 効果 |
|----|------|------------|------|
| B3 | 機能有効 | TRUE | ダブルクリック完了ON/OFF |
| B4 | 完了日自動入力 | TRUE | 完了実績日に今日を入力 |
| B5 | 取り消し線 | TRUE | タスクに取り消し線を適用 |
| B6 | 灰色変更 | TRUE | タスクを濃い灰色に変更 |

---

## No.2 折りたたみ

### 概要

LV1タスクの配下（LV2-4）を非表示/表示に切り替えます。

### 操作方法

**Shift + 右クリック**（C-F列、LV1行のみ有効）

### 動作

- LV1行でShift+右クリック → 配下行を非表示
- 再度Shift+右クリック → 配下行を表示
- 通常の右クリックはコンテキストメニュー表示（従来通り）

---

## No.3 No.自動採番

### 概要

タスクがある行に連番を自動付与します。行挿入後も再採番可能です。

### 使い方

マクロ `RenumberRows` を実行

### 動作

- C-F列にタスク名がある行のみ採番
- 空行はスキップ
- 配列処理で高速化済み

---

## No.4 日付シフト

### 概要

選択した日付を営業日単位でシフトします。祝日マスタの祝日も考慮されます。

### 使い方

1. シフトしたい日付セルを選択
2. マクロ `ShiftDates` を実行
3. 営業日数を入力（例: 5 または -3）

### 祝日考慮

「祝日マスタ」シートのA列に登録された日付が祝日として除外されます。

---

## No.5 PDF出力

### 概要

タスク情報と当月末までのガントチャートをPDFに出力します。

### 使い方

マクロ `ExportToPDF` を実行

### 出力範囲

| 列範囲 | 内容 |
|--------|------|
| A-N列 | タスク情報（LV、No.、タスク、詳細、状況、進捗、担当、日付） |
| O列〜当月末 | ガントチャート |

---

## No.6 日付バリデーション

### 概要

K-N列（日付列）への入力時に形式チェックと論理チェックを行います。

### チェック内容

1. 日付形式チェック（非日付の場合は警告してクリア）
2. 開始予定日 > 完了予定日 の場合に警告

---

## No.7 進捗率バリデーション

### 概要

I列（進捗率）への入力時に範囲チェックを行います。

### チェック内容

- 数値以外の場合は警告してクリア
- 0-100%（または 0-1）の範囲外の場合に警告

---

## No.8 完了ダブルクリック

### 概要

B列をダブルクリックするとタスクを完了状態にします。

### 操作方法

タスク行のB列（No.列）をダブルクリック

### 処理内容（設定マスタで制御可能）

1. 進捗率を100%に設定
2. 状況を「完了」に設定
3. 完了実績日に今日を入力（設定による）
4. タスクに取り消し線（設定による）
5. タスクを濃い灰色に変更（設定による）

---

## 操作早見表

| 操作 | 対象 | 機能 |
|------|------|------|
| B列ダブルクリック | 任意行 | 完了処理 |
| **Shift + 右クリック** | C-F列、LV1行 | 折りたたみ/展開 |
| 右クリック | 任意 | 通常メニュー |

---

## 変更ファイル

| ファイル | 行数 |
|----------|------|
| vba/InazumaGantt_v2_UTF8.bas | 1596行 |
| vba/SheetModule_UTF8.bas | 271行 |
