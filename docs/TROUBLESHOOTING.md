# トラブルシューティング

InazumaGantt v2.2 でよくある問題と解決方法です。

---

## マクロが実行できない

### 症状

「マクロを有効にできません」エラー

### 解決方法

1. ファイル → オプション → セキュリティセンター
2. セキュリティセンターの設定
3. 「すべてのマクロを有効にする」を選択

---

## 文字化けする

### 症状

VBAモジュールをインポートしたら日本語が文字化け

### 解決方法

`vba/` フォルダ内の **`_SJIS.bas`** ファイルをインポートしてください。

| ファイル | 用途 |
|----------|------|
| `_SJIS.bas` | ✅ Excelにインポート用 |
| `_UTF8.bas` | ❌ 編集・Git管理用（インポート不可） |

---

## 階層が自動設定されない

### 症状

タスクを入力してもA列（LV）が自動更新されない

### 原因

シートモジュールが設定されていない

### 解決方法

1. Alt + F11 でVBAエディタを開く
2. 「InazumaGantt_v2」シートをダブルクリック
3. `vba/SheetModule_SJIS.bas` の内容を貼り付け
4. 保存して閉じる

---

## No.や進捗率が自動入力されない

### 症状

タスクを入力してもB列（No.）、H列（状況）、I列（進捗率）が自動入力されない

### 原因

シートモジュールが設定されていない、または古いバージョン

### 解決方法

1. シートモジュールを最新版で再設定（上記参照）
2. `vba/SheetModule_SJIS.bas` の最新版を使用

---

## ガントチャートが表示されない

### 症状

`RefreshInazumaGantt` を実行してもバーが表示されない

### 原因

- 開始予定/完了予定が入力されていない
- 日付がガントチャートの範囲外

### 解決方法

1. K列（開始予定）とL列（完了予定）に日付を入力
2. 日付がガントチャートの表示範囲内か確認

---

## 今日線が表示されない

### 症状

今日の日付の縦線が表示されない

### 原因

今日の日付がガントチャートの範囲外

### 解決方法

1. L2セル（開始日）を今日を含む日付に設定
2. `RefreshInazumaGantt` を再実行

---

## イナズマ線が表示されない

### 症状

オレンジのイナズマ線が表示されない

### 原因

- 対象となるタスクが2つ未満
- すべてのタスクの開始予定が今日より後

### 解決方法

1. 開始予定日が今日以前のタスクが2つ以上あるか確認
2. 完了済みで完了予定が今日より前のタスクはイナズマ線に含まれない仕様です

---

## 階層色分けが適用されない

### 症状

タスクに色がつかない

### 原因

条件付き書式が設定されていない

### 解決方法

```
Alt + F8 → SetupHierarchyColors → 実行
```

一度実行すれば、以降は自動的に色分けが適用されます。

---

## ダブルクリックで完了にならない

### 症状

B列をダブルクリックしても完了にならない

### 原因

- シートモジュールが設定されていない
- 設定マスタで機能が無効になっている

### 解決方法

1. シートモジュールを再設定（上記参照）
2. 「設定マスタ」シートのB3セル（機能有効）がTRUEか確認

---

## 折りたたみが動作しない

### 症状

Shift + 右クリックしても配下が非表示にならない

### 原因

- シートモジュールが設定されていない
- LV1以外の行でクリックしている
- C-F列以外でクリックしている

### 解決方法

1. シートモジュールを最新版で設定
2. LV1（A列が1）の行で、C〜F列をShift + 右クリック

---

## 土日・祝日の色がおかしい

### 症状

開始日を変更したら、土日や祝日の色がずれている

### 解決方法

```
Alt + F8 → ResetFormatting → 実行
```

または「**書式リセット**」ボタンをクリック

---

## 日付ヘッダーがずれている

### 症状

開始日を変更したが、日付ヘッダー（6-8行目）が更新されない

### 解決方法

```
Alt + F8 → RefreshInazumaGantt → 実行
```

v2.2では日付ヘッダーも自動的に再生成されます。

---

## 取り消し線を消したい

### 症状

完了したタスクの取り消し線を解除したい

### 解決方法

1. 対象セル（C〜F列）を選択
2. 右クリック → セルの書式設定
3. フォントタブ → 取り消し線のチェックを外す

---

## 設定マスタシートがない

### 症状

「設定マスタ」シートが存在しない

### 解決方法

```
Alt + F8 → EnsureSettingsSheet → 実行
```

またはセットアップウィザード（`RunSetupWizard`）を再実行

---

## それでも解決しない場合

1. **書式リセットを試す**

   ```
   Alt + F8 → ResetFormatting → 実行
   ```

2. **ガント更新を試す**

   ```
   Alt + F8 → RefreshInazumaGantt → 実行
   ```

3. **開発者向けドキュメント参照**
   - `dev/docs/ARCHITECTURE.md`
   - `dev/docs/CODE_QUALITY.md`

4. **テストを実行**
   - `dev/extra_modules/InazumaGanttTests_SJIS.bas` をインポート
   - Alt + F8 → `RunAllTests` → 実行
