# データ移管ウィザード 使用方法

## 概要

WBS番号型のガントチャートからInazumaGantt v2形式へ柔軟にデータを移管できるウィザードです。

## 特徴

✅ **WBS番号から階層を自動判定** - "1.1.1.1" 形式から LV1〜LV4 を自動認識  
✅ **柔軟な列マッピング** - 元データの列順序に関わらず対応可能  
✅ **設定の保存・再利用** - 同じ形式のファイルを繰り返し移管可能  
✅ **3ステップの簡単操作** - ウィザード形式で直感的に操作

---

## 初回セットアップ

### 1. モジュールのインポート

以下の4つのモジュールをインポートしてください：

- `DataMigration_SJIS.bas`
- `WBSParser_SJIS.bas`
- `DataMigrationWizard_SJIS.bas`
- `MigrationFormBuilder_SJIS.bas`

### 2. UserFormの作成（初回のみ）

1. `Alt + F8` でマクロ一覧を開く
2. `CreateMigrationWizardForm` を選択して実行
3. 「ウィザードフォームを作成しました！」と表示されればOK

> **注意**: VBAプロジェクトへのアクセスが拒否された場合：
>
> 1. Excelのオプション→トラストセンター→トラストセンターの設定
> 2. マクロの設定→「VBAプロジェクトオブジェクトモデルへのアクセスを信頼する」にチェック

---

## 使い方

### Step 1: ウィザードを起動

1. `Alt + F8` でマクロ一覧を開く
2. `MigrateWithWizard` を実行
3. ウィザードが起動します

### Step 2: 移管元シートを選択

1. コンボボックスから移管元のシート名を選択
2. 「次へ」ボタンをクリック

（保存済みの設定がある場合は「保存済み設定を読み込み...」ボタンで読込可能）

### Step 3: 列マッピング設定

各項目に対応する列を選択してください：

| 項目 | 必須 | 説明 |
|------|------|------|
| **WBS番号列** | ✓ | "1.1.1.1" などのWBS番号が入っている列 |
| **タスク名列** | ✓ | タスクの名称が入っている列 |
| **担当者列** |  | 担当者名が入っている列（任意） |
| **完了予定列** |  | 完了予定日が入っている列（任意） |
| **進捗率列** |  | 進捗率（0〜100%）が入っている列（任意） |
| **データ開始行** | ✓ | データが始まる行番号（通常は2） |

設定後、「次へ」ボタンをクリック。

> **設定を保存する場合**: 「この設定を保存する」にチェックを入れると、次回以降再利用できます。

### Step 4: プレビュー確認

移管後のデータプレビューが表示されます（先頭5行のみ）。

問題なければ「実行」ボタンをクリック。

---

## 元データの例

以下のような形式のガントチャートに対応します：

| A (WBS) | B (タスク名) | C (担当者) | D (完了予定) | E (進捗) |
|---------|-------------|-----------|-------------|---------|
| 1 | フェーズ1 | | | |
| 1.1 | 設計 | 田中 | 2026/1/31 | 50% |
| 1.1.1 | UI設計 | 佐藤 | 2026/1/20 | 80% |
| 1.1.1.1 | モックアップ作成 | 佐藤 | 2026/1/15 | 100% |
| 1.2 | 開発 | | | |

---

## 移管後の結果

InazumaGantt v2形式では以下のように変換されます：

| A (LV) | C | D | E | F (タスク名) | J (担当者) | L (完了予定) | I (進捗率) |
|--------|---|---|---|-------------|-----------|-------------|----------|
| 1 | フェーズ1 | | | | | | |
| 2 | | 設計 | | | 田中 | 2026/1/31 | 50% |
| 3 | | | UI設計 | | 佐藤 | 2026/1/20 | 80% |
| 4 | | | | モックアップ作成 | 佐藤 | 2026/1/15 | 100% |

- **A列（LV）**: WBS番号から自動判定した階層レベル（1〜4）
- **C〜F列**: 階層に応じてタスク名を配置（LV1→C、LV2→D、LV3→E、LV4→F）

---

## トラブルシューティング

### Q1. 「ウィザードフォームが見つかりません」と表示される

A. 初回セットアップで `CreateMigrationWizardForm` を実行してください。

### Q2. WBS番号が正しく認識されない

A. WBS番号は "1", "1.1", "1.1.1", "1.1.1.1" の形式である必要があります。  
   0始まり（"0.1"）や5階層以上（"1.1.1.1.1"）には対応していません。

### Q3. 移管後に階層が表示されない

A. 移管後、`RefreshInazumaGantt` マクロを実行してガントチャートを更新してください。

### Q4. 設定が保存されない

A. 「設定マスタ」シートへの書き込み権限を確認してください。  
   ファイルが読み取り専用になっていないか確認してください。

---

## 開発者向け情報

### テスト方法

WBS解析のテストコードが含まれています：

```vba
' VBAエディタのイミディエイトウィンドウで実行
WBSParser.TestWBSParser
```

### マッピング設定の保存場所

設定は「設定マスタ」シートに保存されます。

| A (設定名) | B (移管元シート) | C (WBS列) | D (タスク名列) | ... |
|-----------|----------------|----------|---------------|-----|
| Backlog移管 | Backlogシート | A | B | ... |

---

## 関連ドキュメント

- [vba/README.md](vba/README.md) - VBAモジュール全体の説明
- [dev/docs/ARCHITECTURE.md](dev/docs/ARCHITECTURE.md) - システム構成図
- [implementation_plan.md](implementation_plan.md) - 実装計画（開発者向け）
